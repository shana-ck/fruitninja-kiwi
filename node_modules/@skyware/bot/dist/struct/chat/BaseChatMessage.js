import { asDid } from "../../util/lexicon.js";
/**
 * Represents some message in a chat conversation. This class is not meant to be used directly.
 * @see ChatMessage
 * @see DeletedChatMessage
 */
export class BaseChatMessage {
    bot;
    /** The message's ID. */
    id;
    /** The ID of the conversation the message belongs to. */
    conversationId;
    /** The DID of the message's sender. */
    senderDid;
    /** When the message was sent. */
    sentAt;
    /** The profile of the user who sent the message. */
    sender;
    /** The Conversation instance this message belongs to. */
    conversation;
    /**
     * @param data Data used to construct the message.
     * @param bot The active Bot instance.
     */
    constructor({ id, conversationId, sender, sentAt }, bot) {
        this.bot = bot;
        this.id = id;
        if (conversationId)
            this.conversationId = conversationId;
        this.senderDid = asDid(sender.did);
        this.sentAt = sentAt;
    }
    /**
     * Fetch the profile of the user who sent this message.
     */
    async getSender() {
        if (this.sender)
            return this.sender;
        if (this.senderDid === this.bot.profile.did)
            return this.sender = this.bot.profile;
        return this.sender = await this.bot.getProfile(this.senderDid);
    }
    /**
     * Fetch the Conversation instance this message belongs to.
     * Returns null if the conversation could not be found.
     */
    async getConversation() {
        if (this.conversation)
            return this.conversation;
        if (!this.conversationId)
            return null;
        return this.conversation = await this.bot.getConversation(this.conversationId);
    }
}
